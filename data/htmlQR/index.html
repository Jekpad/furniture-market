<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <script type="text/javascript" src="qrcode.js">
	</script>
    <script type="text/javascript" src="html5-qrcode.js">
	</script>
    <script type="text/javascript" src="utf8.js">
	</script>
	<script type="text/javascript">
		if(addon)//available as experimental feature for trusted panel source files in jetpack sdk
		{
			addon.port.on("myAddonScriptEvent", function(payloadFromAddon)
			{
				if(payloadFromAddon["event"]=="showQR")
				{
					updateQRCode(payloadFromAddon["text"], payloadFromAddon["version"], payloadFromAddon["errorCorrectLevel"], 295);
				}
			});
		}
		function updateQRCode(text, version, errorCorrectLevel)
		{
			text = Utf8.encode(text);
			var element = document.getElementById("qrcode");

			if(element)
			{
				if(element.lastChild)
				  element.replaceChild(showQRCode(text, version, errorCorrectLevel), element.lastChild);
				else
				  element.appendChild(showQRCode(text, version, errorCorrectLevel));
			}
			else
			{
				textFromAddon = text;
			}
		}
		function onLoad()
		{
			if(textFromAddon)
			{
				updateQRCode(textFromAddon);
				textFromAddon = undefined;
			}
			else
			{
				var url=document.URL;
				var spliturl=url.split("?");
				var paramstr = "";
				if(spliturl.length>1)
				{
					paramstr = spliturl.splice(1).join("?");
				}
				var splitparams = paramstr.split("&");
				for(var i=0; i<splitparams.length; i++)
				{
					var param = splitparams[i];
					var splitparam = param.split("=");
					if(splitparam.length==2)
					{
						var name=splitparam[0];
						var value=unescape(splitparam[1]);
						if(name=="loadText")
						{
							updateQRCode(value);
							break;
						}
					}
				}
			}
		}
	</script>
  </head>
  <body onload="onLoad()" style="margin: 0px; width: 300px">
  <!-- This is where our QRCode will appear in. -->
    <div id="qrcode"></div>
  </body>
</html>