<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <script type="text/javascript" src="qrcode.js">
	</script>
    <script type="text/javascript" src="html5-qrcode.js">
	</script>
    <script type="text/javascript" src="utf8.js">
	</script>
	<script type="text/javascript">
		if(addon)//available as experimental feature for trusted panel source files in jetpack sdk
		{
			addon.port.on("myAddonScriptEvent", function(payloadFromAddon)
			{
				if(payloadFromAddon["event"]=="showQR")
				{
					updateQRCode(payloadFromAddon["text"], payloadFromAddon["version"], payloadFromAddon["errorCorrectLevel"], payloadFromAddon["panelSize"]-5);
				}
			});
		}
		
		var pendingPayloadFromAddon;
		function updateQRCode(text, version, errorCorrectLevel, canvasSize)
		{
			var element = document.getElementById("qrcode");

			if(element)
			{
				if(element.lastChild)
				  element.replaceChild(showQRCode(text, version, errorCorrectLevel, canvasSize), element.lastChild);
				else
				  element.appendChild(showQRCode(text, version, errorCorrectLevel, canvasSize));
				  
				 element.style.width = "100%";
				 element.style.height = "100%";
			}
			else
			{
				pendingPayloadFromAddon = {"text": text, "version": version, "errorCorrectLevel": errorCorrectLevel, "canvasSize": canvasSize};
			}
		}
		function onLoad()
		{
			if(pendingPayloadFromAddon)
			{
				updateQRCode(pendingPayloadFromAddon["text"],
							pendingPayloadFromAddon["version"],
							pendingPayloadFromAddon["errorCorrectLevel"],
							pendingPayloadFromAddon["canvasSize"]
							);
				pendingPayloadFromAddon = undefined;
			}
		}
	</script>
  </head>
  <body onload="onLoad()" style="margin:0px;">
  <!-- This is where our QRCode will appear in. -->
    <div id="qrcode" style="line-height:0"></div>
  </body>
</html>